<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>
<%@ taglib uri="http://java.sun.com/jsp/jstl/fmt" prefix="fmt" %>
<c:set var="ctx" value="${pageContext.request.contextPath}"/>
<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <meta name="renderer" content="webkit">
    <title>游记审核</title>
    <link rel="stylesheet" href="${ctx}/css/pintuer.css">
    <link rel="stylesheet" href="${ctx}/css/admin.css">
    <script src="${ctx}/js/jquery.js"></script>
    <script src="${ctx}/js/pintuer.js"></script>
    <script type="text/javascript">
        var rejectId="";
        var idSelected ="";
        var journeyContent="";
        $(function () {
            $(".page-btn:first,.message:first").show();
            var $todo = $("#todo"),
                $success = $("#success"),
                $fail = $("#fail"),
                $message = $(".message"),
                $pageBtn = $(".page-btn");

            //点击删除事件
            $("a[href='#del']").css("color", "red")
                .click(function () {
                    $(this).hide();
                    $("a[href='#yes'], a[href='#no'], table th:first, .ckb, .all").show();
                });
            //点击确认删除
            $("a[href='#yes']").click(function () {
                var intL = $("input:checked").length; // 获取所有复选框选中项
                if (intL != 0) { // 如果有选中项
                    alert("您确定要删除所选项吗？");
                    $("input[type=checkbox]").each(function (index) { // 遍历全部复选框的行
                        if (this.checked) { // 如果选中
                            idSelected += ($(this).parent("td").next("td").text() + ",");//获取勾选项id
                        }
                    });
                    $.ajax({
                        type:'post',
                        url: "${ctx}/admin/audit/journey/delete", // 请求处理页
                        dataType: "html",
                        data: {idSelected: idSelected},
                        success: function (result) {
                            if (result == '0'){
                                alert("删除失败");
                            }
                            else {
                                alert("删除成功");
                            }
                            window.location.href = "${ctx}/admin/audit/journey";
                        }
                    });
                } else {
                    alert("请先选中要删除的项！");
                }
            });
            //点击取消删除
            $("a[href='#no']").click(function () {
                $("a[href='#yes'], a[href='#no'], table th:first, .ckb, .all").hide();
                $("a[href='#del']").show();
            });

            //待审核全选复选框
            $todo.find("input[value='all']").click(function () {
                if (this.checked) { // 如果自己被选中
                    $todo.find("input[type=checkbox]").prop("checked", true);
                } else { // 如果自己没被选中
                    $todo.find("input[type=checkbox]").prop("checked", false);
                }
            });
            //审核通过全选复选框
            $success.find("input[value='all']").click(function () {
                if (this.checked) { // 如果自己被选中
                    $success.find("input[type=checkbox]").prop("checked", true);
                } else { // 如果自己没被选中
                    $success.find("input[type=checkbox]").prop("checked", false);
                }
            });
            //审核通过全选复选框
            $fail.find("input[value='all']").click(function () {
                if (this.checked) { // 如果自己被选中
                    $fail.find("input[type=checkbox]").prop("checked", true);
                } else { // 如果自己没被选中
                    $fail.find("input[type=checkbox]").prop("checked", false);
                }
            });

            $("select").change(function () {
                $message.hide();
                $pageBtn.hide();
                if($(this).get(0).selectedIndex === 0){ //待审核
                    $success.hide();
                    $fail.hide();

                    $todo.show();
                    $todo.next().show();
                    $todo.next().next().show();
                }
                //审核通过
                else if($(this).get(0).selectedIndex === 1){
                    $todo.hide();
                    $fail.hide();

                    $success.show();
                    $success.next().show();
                    $success.next().next().show();
                }
                //审核不通过
                else{
                    $todo.hide();
                    $success.hide();

                    $fail.show();
                    $fail.next().show();
                    $fail.next().next().show();
                }
            });

            //删除已审核的游记,获取对应id
            $(".delete").click(function () {
                var sure = confirm("确定删除该游记吗？");
                if(sure){
                    idSelected=$(this).parent().siblings(".ac-com").text();
                    $.ajax({
                        type:'post',
                        url: "${ctx}/admin/audit/journey/delete", // 请求处理页
                        dataType: "html",
                        data: {idSelected:idSelected},
                        success: function (result) {
                            if (result == '0'){
                                alert("删除失败");
                            }
                            else {
                                alert("删除成功");
                            }
                            window.location.href = "${ctx}/admin/audit/journey";
                        }
                    });
                }
            });

            //拒绝模态框获取选择id
            $(".reject").click(function () {
                rejectId = $(this).parent().siblings(".ac-com").text();
            });

            //显示游记
            $(".journey").click(function () {
                alert($(this).parent().siblings(".ac-com").text());
                $(".my-test-journey").html("");//清空标签间的内容
                journeyContent = $(this).parent().siblings(".ac-details").html();
                $(".my-test-journey").prepend(journeyContent);
                $.ajax({
                    type:'post',
                    url: "", // 请求处理页
                    dataType: "html",
                    data: {},
                    success: function (result) {
                        window.location.href = "";
                    }
                });
            })
        });

        //上传审核失败原因
        function sendReason() {
            var managerReplyContent =   $(".dialog-body textarea").text();

            $.ajax({
                type:'post',
                url: "${ctx}/admin/audit/journey/sendReason", // 请求处理页
                dataType: "html",
                data: {rejectId:rejectId,managerReplyContent:managerReplyContent},
                success: function (result) {
                    if (result == '0'){
                        alert("发送失败");
                    }
                    else {
                        alert("发送成功");
                    }
                    window.location.href = "${ctx}/admin/audit/journey";
                }
            });
        }

    </script>
    <style>
        a[href='#del']{color: red}
        a[href='#yes'],a[href='#no']{display: none}
        .ckb{display: none}
        .message{margin: 20px 20px 0 20px;display: none}
        .pagination{margin-bottom: 30px}
        .pagination .active{background: #337ab7!important}
        .active a{color: #fff!important}
        .pagination a{border: 1px solid #eee!important}
        select {
            display: inline !important;
            margin-left: 10px;
            width: 15% !important;
        }
        /*已审核全选框*/
        .all{display: none}
        #success,#fail{display: none}
        .table{border-bottom: 2px solid #eee}
        .page-btn{text-align:center;margin-top: -20px;display: none}
        .ac-com,.ac-details{display: none}
    </style>
</head>
<body>
<!--否决模态框-->
<div id="reject">
    <div class="dialog">
        <div class="dialog-head">
            <span class="close rotate-hover"></span><strong>回复否决理由</strong>
        </div>
        <div class="dialog-body">
            <textarea rows="5" style="width: 100%" class="input" placeholder="请输入否决理由"></textarea>
        </div>
        <div class="dialog-foot">
            <button class="button dialog-close">
                取消</button>
            <button class="button bg-green" onclick="sendReason()">
                发送</button>
        </div>
    </div>
</div>

<!--游记模态框-->
<div id="journey">
    <div class="dialog">
        <div class="dialog-head">
            <span class="close rotate-hover"></span><strong>查看游记</strong>
        </div>
        <div class="dialog-body my-test-journey" style="max-height:330px;overflow: scroll;overflow-x: hidden">
            123
        </div>
        <div class="dialog-foot">
            <button class="button dialog-close">
                关闭</button>
        </div>
    </div>
</div>

<div class="panel admin-panel">
    <div class="panel-head">
        <strong><span class="icon-check-square-o"></span> 游记审核</strong>
        <select class="input" name="auditType">
            <option value="todo">待审核</option>
            <option value="success">审核通过</option>
            <option value="fail">审核不通过</option>
        </select>
        <span style="float: right;line-height: 42px">
            <a class="icon-trash-o" href="#del" style="margin-right: 20px"> 删除</a>
            <a href="#yes"> 确认删除</a>&nbsp;
            <a href="#no" style="margin-right: 20px"> 取消删除</a>
        </span>
    </div>

    <!--待审核-->
    <table id="todo" class="table table-hover text-center">
        <tr>
            <th width="10%" class="all">
                全选 <input type="checkbox" value="all">
            </th>
            <th width="20%">用户名</th>
            <th width="20%">查看</th>
            <th width="20%">上传时间</th>
            <th width="10%">浏览量</th>
            <th width="20%">审核</th>
        </tr>
        <c:forEach items="${undoTravelnotes.list}" var="note">
            <tr>
                <td class="ckb"><input type="checkbox"></td>
                <td class="ac-com">${note.id}</td>
                <td>${note.userRealName}</td>
                <td>
                    <a href="#" class="dialogs" data-toggle="click" data-target="#journey" data-mask="1" data-width="40%">游记内容</a>
                        <%--/ <a href="${ctx}/admin/journeyComment/show?noteId=${note.id}">游记评论</a>--%>
                </td>
                <td><fmt:formatDate value="${note.createTime }" pattern="yyyy-MM-dd HH:mm"/></td>
                <td>${note.browseTimes}</td>
                <td>
                    <a href="${ctx}/admin/audit/journey/pass?noteId=${note.id}">通过并发布</a> /
                    <a href="#" class="dialogs reject" data-toggle="click" data-target="#reject" data-mask="1" data-width="50%">否决</a>
                </td>
            </tr>
        </c:forEach>
    </table>
    <!-- 页数 -->
    <div class="message">
        共<i class="blue">${undoTravelnotes.total}</i>条记录，当前显示第&nbsp;<i
            class="blue">${undoTravelnotes.pageNum}/${undoTravelnotes.pages}</i>&nbsp;页
    </div>
    <div class="page-btn">
        <ul class="pagination">
            <!-- <li><a href="#">&laquo;</a></li> -->
            <c:if test="${!undoTravelnotes.isFirstPage}">
                <li><a href="${ctx}/admin/audit/journey?pageNumber1=1&pageSize1=${undoTravelnotes.pageSize}">首页</a></li>
                <li><a href="${ctx}/admin/audit/journey?pageNumber1=${undoTravelnotes.prePage}&pageSize1=${undoTravelnotes.pageSize}">上一页</a></li>
            </c:if>
            <c:forEach items="${undoTravelnotes.navigatepageNums}" var="navigatepageNum1">
                <c:if test="${navigatepageNum1==undoTravelnotes.pageNum}">
                    <li class="active"><a href="${ctx}/admin/audit/journey?pageNumber1=${navigatepageNum1}&pageSize1=${undoTravelnotes.pageSize}">${navigatepageNum1}</a></li>
                </c:if>
                <c:if test="${navigatepageNum1!=undoTravelnotes.pageNum}">
                    <li><a href="${ctx}/admin/audit/journey?pageNumber1=${navigatepageNum1}&pageSize1=${undoTravelnotes.pageSize1}">${navigatepageNum1}</a></li>
                </c:if>
            </c:forEach>
            <c:if test="${!undoTravelnotes.isLastPage}">
                <li><a href="${ctx}/admin/audit/journey?pageNumber1=${undoTravelnotes.nextPage}&pageSize1=${undoTravelnotes.pageSize}">下一页</a></li>
                <li><a href="${ctx}/admin/audit/journey?pageNumber1=${undoTravelnotes.pages}&pageSize1=${undoTravelnotes.pageSize}">最后一页</a></li>
            </c:if>
        </ul>
    </div>

    <!--审核通过-->
    <table id="success" class="table table-hover text-center">
        <tr >
            <th width="10%" class="all">
                全选 <input type="checkbox" value="all">
            </th>
            <th width="20%">用户名</th>
            <th width="20%">查看</th>
            <th width="20%">发布时间</th>
            <th width="10%">浏览量</th>
            <th width="20%">管理</th>
        </tr>
        <c:forEach items="${passTravelnotes.list}" var="note2">
            <tr>
                <td class="ckb"><input type="checkbox"></td>
                <td class="ac-com">${note2.id}</td>
                <td class="ac-details">${note2.content}</td>
                <td>${note2.userRealName}</td>
                <td>
                    <a href="#" class="dialogs journey" data-toggle="click" data-target="#journey" data-mask="1" data-width="40%">游记内容</a>
                        <%--/ <a href="${ctx}/admin/journeyComment/show?noteId=${note2.id}">游记评论</a>--%>
                </td>
                <td><fmt:formatDate value="${note2.createTime }" pattern="yyyy-MM-dd HH:mm"/></td>
                <td>${note2.browseTimes}</td>
                <td>
                    <a href="#" class="delete">删除</a>/
                    <a href="${ctx}/admin/audit/journey/moreDetail?noteId=${note2.id}">更多详情</a>
                </td>
            </tr>
        </c:forEach>
    </table>
    <!-- 页数 -->
    <div class="message">
        共<i class="blue">${passTravelnotes.total}</i>条记录，当前显示第&nbsp;<i
            class="blue">${passTravelnotes.pageNum}/${passTravelnotes.pages}</i>&nbsp;页
    </div>
    <div class="page-btn">
        <ul class="pagination">
            <!-- <li><a href="#">&laquo;</a></li> -->
            <c:if test="${!passTravelnotes.isFirstPage}">
                <li><a href="${ctx}/admin/audit/journey?pageNumber2=1&pageSize2=${passTravelnotes.pageSize}">首页</a></li>
                <li><a href="${ctx}/admin/audit/journey?pageNumber2=${passTravelnotes.prePage}&pageSize2=${passTravelnotes.pageSize}">上一页</a></li>
            </c:if>
            <c:forEach items="${passTravelnotes.navigatepageNums}" var="navigatepageNum2">
                <c:if test="${navigatepageNum2==passTravelnotes.pageNum}">
                    <li class="active"><a href="${ctx}/admin/audit/journey?pageNumber2=${navigatepageNum2}&pageSize2=${passTravelnotes.pageSize}">${navigatepageNum2}</a></li>
                </c:if>
                <c:if test="${navigatepageNum2!=passTravelnotes.pageNum}">
                    <li><a href="${ctx}/admin/audit/journey?pageNumber2=${navigatepageNum2}&pageSize2=${passTravelnotes.pageSize2}">${navigatepageNum2}</a></li>
                </c:if>
            </c:forEach>
            <c:if test="${!passTravelnotes.isLastPage}">
                <li><a href="${ctx}/admin/audit/journey?pageNumber2=${passTravelnotes.nextPage}&pageSize2=${passTravelnotes.pageSize}">下一页</a></li>
                <li><a href="${ctx}/admin/audit/journey?pageNumber2=${passTravelnotes.pages}&pageSize2=${passTravelnotes.pageSize}">最后一页</a></li>
            </c:if>
        </ul>
    </div>

    <!--审核不通过-->
    <table id="fail" class="table table-hover text-center">
        <tr >
            <th width="10%" class="all">
                全选 <input type="checkbox" value="all">
            </th>
            <th width="20%">用户名</th>
            <th width="20%">查看</th>
            <th width="20%">发布时间</th>
            <th width="10%">浏览量</th>
            <th width="20%">管理</th>
        </tr>
        <c:forEach items="${unpassTravelnotes.list}" var="note3">
            <tr>
                <td class="ckb"><input type="checkbox"></td>
                <td class="ac-com">${note3.id}</td>
                <td class="ac-details">${note3.content}</td>
                <td>${note3.userRealName}</td>
                <td>
                    <a href="#" class="dialogs journey" data-toggle="click" data-target="#journey" data-mask="1" data-width="50%">游记内容</a>
                        <%--/ <a href="${ctx}/admin/journeyComment/show?noteId=${note3.id}">游记评论</a>--%>
                </td>
                <td><fmt:formatDate value="${note3.createTime }" pattern="yyyy-MM-dd HH:mm"/></td>
                <td>${note3.browseTimes}</td>
                <td>
                    <a href="#" class="dialogs delete" data-toggle="click" data-target="#delete" data-mask="1" data-width="50%">删除</a>/
                    <a href="${ctx}/admin/audit/journey/moreDetail?noteId=${note3.id}">更多详情</a>
                </td>
            </tr>
        </c:forEach>
    </table>
    <!-- 页数 -->
    <div class="message">
        共<i class="blue">${unpassTravelnotes.total}</i>条记录，当前显示第&nbsp;<i
            class="blue">${unpassTravelnotes.pageNum}/${unpassTravelnotes.pages}</i>&nbsp;页
    </div>
    <div class="page-btn">
        <ul class="pagination">
            <!-- <li><a href="#">&laquo;</a></li> -->
            <c:if test="${!unpassTravelnotes.isFirstPage}">
                <li><a href="${ctx}/admin/audit/journey?pageNumber3=1&pageSize3=${unpassTravelnotes.pageSize}">首页</a></li>
                <li><a href="${ctx}/admin/audit/journey?pageNumber3=${unpassTravelnotes.prePage}&pageSize3=${unpassTravelnotes.pageSize}">上一页</a></li>
            </c:if>
            <c:forEach items="${unpassTravelnotes.navigatepageNums}" var="navigatepageNum3">
                <c:if test="${navigatepageNum3==unpassTravelnotes.pageNum}">
                    <li class="active"><a href="${ctx}/admin/audit/journey?pageNumber3=${navigatepageNum3}&pageSize3=${unpassTravelnotes.pageSize}">${navigatepageNum3}</a></li>
                </c:if>
                <c:if test="${navigatepageNum3!=unpassTravelnotes.pageNum}">
                    <li><a href="${ctx}/admin/audit/journey?pageNumber3=${navigatepageNum3}&pageSize3=${unpassTravelnotes.pageSize3}">${navigatepageNum3}</a></li>
                </c:if>
            </c:forEach>
            <c:if test="${!unpassTravelnotes.isLastPage}">
                <li><a href="${ctx}/admin/audit/journey?pageNumber3=${unpassTravelnotes.nextPage}&pageSize3=${unpassTravelnotes.pageSize}">下一页</a></li>
                <li><a href="${ctx}/admin/audit/journey?pageNumber3=${unpassTravelnotes.pages}&pageSize3=${unpassTravelnotes.pageSize}">最后一页</a></li>
            </c:if>
        </ul>
    </div>
</div>
</body>
</html>
